# ============================================================
# HEALTHFLOW - PRODUCTION OVERLAY
# ============================================================
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: healthflow-production

resources:
  - ../../base

patches:
  # Increase resources for production
  - target:
      kind: Deployment
      name: healthflow-api
    patch: |
      - op: replace
        path: /spec/template/spec/containers/0/resources/requests/cpu
        value: "500m"
      - op: replace
        path: /spec/template/spec/containers/0/resources/requests/memory
        value: "1Gi"
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/cpu
        value: "2000m"
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/memory
        value: "2Gi"
  - target:
      kind: Deployment
      name: healthflow-web
    patch: |
      - op: replace
        path: /spec/template/spec/containers/0/resources/requests/cpu
        value: "250m"
      - op: replace
        path: /spec/template/spec/containers/0/resources/requests/memory
        value: "512Mi"
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/cpu
        value: "1000m"
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/memory
        value: "1Gi"
  # Increase storage for production
  - target:
      kind: StatefulSet
      name: postgres
    patch: |
      - op: replace
        path: /spec/volumeClaimTemplates/0/spec/resources/requests/storage
        value: 100Gi

commonLabels:
  environment: production

images:
  - name: ghcr.io/healthflow/healthflow-api
    newTag: latest
  - name: ghcr.io/healthflow/healthflow-web
    newTag: latest
